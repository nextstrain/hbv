# Nextstrain Hepatitis-B (HBV) builds

This is an [Observable Framework](https://observablehq.com/framework) project.
The notebook generated by this is uploaded to GitHub pages 


### Environment / Dependencies
You'll need nodejs installed in the same environment as python3, ideally in the
same environment you are using for the bioinformatic workflows. This is because
some of the notebook's data loaders (`./docs/data`) are written in python. Then
install the notebook dependencies via
```
npm ci
```

### Running the notebook locally
```
npm run dev
```

### Deploying to GitHub Pages

GitHub pages serves this notebook at [nextstrain.github.io/hbv](https://nextstrain.github.io/hbv). The deploy process is inspired by [this gist](https://gist.github.com/renatoathaydes/75fcf8c5104134ae112f367d5e4f3f50).

> The current deploy process is not automated as building the notebook requires data from the ingest pipeline, but as we automate these pipelines we can also automate the notebook build + github pages deployment


**prerequisites**

Set up a git worktree to track the `gh-pages` branch, for example:

```
git worktree add -B gh-pages dist origin/gh-pages
```

The files inside `./dist` represent the top-level files for the repo on the (orphaned) `gh-pages` branch.

**deploy**

```sh
# build the notebook
cd notebook && npm run build && cd - 
# copy the files to the gh-pages branch (worktree)
rm -rf dist/* && cp -r notebook/dist/* ./dist/
# (optional) preview the build
npx http-server dist
# commit & push the gh-pages branch
cd dist && git add . && git commit -m 'notebook rebuild for github pages' && git push && cd ..
```